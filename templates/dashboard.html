<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard - CryoProtect Analyzer</title>
  
  <!-- Supabase Configuration -->
  <meta name="supabase-url" content="{{ supabase_url }}">
  <meta name="supabase-key" content="{{ supabase_key }}">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="/">
        <i class="bi bi-snow2"></i> CryoProtect <span>Analyzer</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/dashboard">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/molecules">Molecules</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/mixtures">Mixtures</a>
          </li>
          <li class="nav-item dropdown nav-authenticated d-none">
            <a class="nav-link dropdown-toggle" href="#" id="analysisDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Analysis
            </a>
            <ul class="dropdown-menu" aria-labelledby="analysisDropdown">
              <li><a class="dropdown-item" href="/predictions">Predictions</a></li>
              <li><a class="dropdown-item" href="/experiments">Experiments</a></li>
              <li><a class="dropdown-item" href="/comparisons">Comparisons</a></li>
            </ul>
          </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item nav-unauthenticated">
            <a class="nav-link" href="/login">Login</a>
          </li>
          <li class="nav-item dropdown nav-authenticated d-none">
            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-circle"></i> <span class="user-name">User</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="/profile">Profile</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="#" id="logout-button">Logout</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container py-4">
    <div class="row mb-4">
      <div class="col-md-8">
        <h1 class="mb-3">User Dashboard</h1>
        <p class="lead">
          Manage your projects and experiments in one place.
        </p>
      </div>
      <div class="col-md-4 text-end d-flex align-items-center justify-content-end">
        <button class="btn btn-primary" id="create-project-btn">
          <i class="bi bi-plus-circle"></i> Create Project
        </button>
      </div>
    </div>

    <!-- Dashboard Overview -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card dashboard-stat-card">
          <div class="card-body text-center">
            <i class="bi bi-folder-fill stat-icon"></i>
            <h2 class="stat-value" id="total-projects">0</h2>
            <p class="stat-label">Projects</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card dashboard-stat-card">
          <div class="card-body text-center">
            <i class="bi bi-flask-fill stat-icon"></i>
            <h2 class="stat-value" id="total-experiments">0</h2>
            <p class="stat-label">Experiments</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card dashboard-stat-card">
          <div class="card-body text-center">
            <i class="bi bi-share-fill stat-icon"></i>
            <h2 class="stat-value" id="shared-projects">0</h2>
            <p class="stat-label">Shared Projects</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card dashboard-stat-card">
          <div class="card-body text-center">
            <i class="bi bi-clock-history stat-icon"></i>
            <h2 class="stat-value" id="recent-activity">0</h2>
            <p class="stat-label">Recent Activities</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard Content -->
    <div class="row">
      <!-- Left Column - Projects -->
      <div class="col-md-8">
        <!-- Projects Section -->
        <div class="card mb-4">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">My Projects</h5>
            <div class="input-group w-50">
              <input type="text" class="form-control" placeholder="Search projects..." id="project-search">
              <button class="btn btn-outline-secondary" type="button" id="project-search-btn">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover" id="projects-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Experiments</th>
                    <th>Last Updated</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="projects-list">
                  <!-- Projects will be loaded here -->
                  <tr class="placeholder-row">
                    <td colspan="4" class="text-center">Loading projects...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-3">
              <div>
                <span id="projects-count">0</span> projects
              </div>
              <div>
                <button class="btn btn-sm btn-outline-primary" id="load-more-projects">
                  Load More
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Experiment Distribution Chart -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">Experiment Distribution</h5>
          </div>
          <div class="card-body">
            <div id="experiment-distribution-chart" style="height: 300px;"></div>
          </div>
        </div>
      </div>

      <!-- Right Column - Activity & Quick Access -->
      <div class="col-md-4">
        <!-- Recent Activity -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">Recent Activity</h5>
          </div>
          <div class="card-body p-0">
            <ul class="list-group list-group-flush" id="activity-list">
              <!-- Activity items will be loaded here -->
              <li class="list-group-item text-center">Loading activity...</li>
            </ul>
          </div>
          <div class="card-footer text-center">
            <a href="#" class="btn btn-sm btn-link" id="view-all-activity">View All Activity</a>
          </div>
        </div>

        <!-- Quick Access -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">Quick Access</h5>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              <button class="btn btn-outline-primary" id="create-experiment-btn">
                <i class="bi bi-flask"></i> New Experiment
              </button>
              <button class="btn btn-outline-primary" id="import-data-btn">
                <i class="bi bi-upload"></i> Import Data
              </button>
              <button class="btn btn-outline-primary" id="export-results-btn">
                <i class="bi bi-download"></i> Export Results
              </button>
              <button class="btn btn-outline-primary" id="share-project-btn">
                <i class="bi bi-share"></i> Share Project
              </button>
            </div>
          </div>
        </div>

        <!-- Saved Searches -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">Saved Searches</h5>
          </div>
          <div class="card-body p-0">
            <ul class="list-group list-group-flush" id="saved-searches-list">
              <!-- Saved searches will be loaded here -->
              <li class="list-group-item text-center">Loading saved searches...</li>
            </ul>
          </div>
          <div class="card-footer text-center">
            <a href="#" class="btn btn-sm btn-link" id="manage-saved-searches">Manage Saved Searches</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Create Project Modal -->
  <div class="modal fade" id="create-project-modal" tabindex="-1" aria-labelledby="create-project-modal-label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="create-project-modal-label">Create New Project</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="create-project-form">
            <div class="mb-3">
              <label for="project-name" class="form-label">Project Name</label>
              <input type="text" class="form-control" id="project-name" required>
            </div>
            <div class="mb-3">
              <label for="project-description" class="form-label">Description</label>
              <textarea class="form-control" id="project-description" rows="3"></textarea>
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="project-public">
              <label class="form-check-label" for="project-public">
                Make this project public
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="create-project-submit">Create Project</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Project Details Modal -->
  <div class="modal fade" id="project-details-modal" tabindex="-1" aria-labelledby="project-details-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="project-details-modal-label">Project Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-4">
            <div class="col-md-8">
              <h3 id="project-detail-name">Project Name</h3>
              <p id="project-detail-description" class="text-muted">Project description will appear here.</p>
            </div>
            <div class="col-md-4 text-end">
              <span class="badge bg-primary" id="project-detail-status">Active</span>
              <p class="text-muted mt-2">
                Created: <span id="project-detail-created">01/01/2025</span>
              </p>
            </div>
          </div>

          <ul class="nav nav-tabs" id="projectDetailTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="experiments-tab" data-bs-toggle="tab" data-bs-target="#experiments-tab-pane" type="button" role="tab" aria-controls="experiments-tab-pane" aria-selected="true">Experiments</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity-tab-pane" type="button" role="tab" aria-controls="activity-tab-pane" aria-selected="false">Activity</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings-tab-pane" type="button" role="tab" aria-controls="settings-tab-pane" aria-selected="false">Settings</button>
            </li>
          </ul>
          <div class="tab-content" id="projectDetailTabsContent">
            <div class="tab-pane fade show active" id="experiments-tab-pane" role="tabpanel" aria-labelledby="experiments-tab" tabindex="0">
              <div class="p-3">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5>Project Experiments</h5>
                  <button class="btn btn-sm btn-primary" id="add-experiment-btn">
                    <i class="bi bi-plus-circle"></i> Add Experiment
                  </button>
                </div>
                <div class="table-responsive">
                  <table class="table table-hover" id="project-experiments-table">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Date Performed</th>
                        <th>Property</th>
                        <th>Value</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="project-experiments-list">
                      <!-- Project experiments will be loaded here -->
                      <tr class="placeholder-row">
                        <td colspan="5" class="text-center">Loading experiments...</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="activity-tab-pane" role="tabpanel" aria-labelledby="activity-tab" tabindex="0">
              <div class="p-3">
                <h5>Project Activity</h5>
                <ul class="list-group list-group-flush" id="project-activity-list">
                  <!-- Project activity will be loaded here -->
                  <li class="list-group-item text-center">Loading activity...</li>
                </ul>
              </div>
            </div>
            <div class="tab-pane fade" id="settings-tab-pane" role="tabpanel" aria-labelledby="settings-tab" tabindex="0">
              <div class="p-3">
                <h5>Project Settings</h5>
                <form id="update-project-form">
                  <div class="mb-3">
                    <label for="update-project-name" class="form-label">Project Name</label>
                    <input type="text" class="form-control" id="update-project-name" required>
                  </div>
                  <div class="mb-3">
                    <label for="update-project-description" class="form-label">Description</label>
                    <textarea class="form-control" id="update-project-description" rows="3"></textarea>
                  </div>
                  <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="update-project-public">
                    <label class="form-check-label" for="update-project-public">
                      Make this project public
                    </label>
                  </div>
                  <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-danger" id="delete-project-btn">Delete Project</button>
                    <button type="button" class="btn btn-primary" id="update-project-btn">Save Changes</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Experiment to Project Modal -->
  <div class="modal fade" id="add-experiment-modal" tabindex="-1" aria-labelledby="add-experiment-modal-label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="add-experiment-modal-label">Add Experiment to Project</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="add-experiment-form">
            <div class="mb-3">
              <label for="experiment-select" class="form-label">Select Experiment</label>
              <select class="form-select" id="experiment-select" required>
                <option value="" selected disabled>Choose an experiment...</option>
                <!-- Experiments will be loaded here -->
              </select>
            </div>
            <div class="mb-3">
              <label for="experiment-notes" class="form-label">Notes</label>
              <textarea class="form-control" id="experiment-notes" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="add-experiment-submit">Add Experiment</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-light py-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <p>&copy; 2025 CryoProtect Analyzer. All rights reserved.</p>
        </div>
        <div class="col-md-6 text-md-end">
          <a href="#" class="text-decoration-none me-3">Privacy Policy</a>
          <a href="#" class="text-decoration-none me-3">Terms of Service</a>
          <a href="#" class="text-decoration-none">Contact</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Plotly.js -->
  <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.27.1/plotly.min.js"></script>
  
  <!-- Custom JS -->
  <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
  <script src="{{ url_for('static', filename='js/auth-ui.js') }}"></script>
  <script src="{{ url_for('static', filename='js/api.js') }}"></script>
  <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
  <script src="{{ url_for('static', filename='js/project-dashboard.js') }}"></script>
</body>
</html>